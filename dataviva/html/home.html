{% extends "templates/site.html" %}

{% block head %}

  <link type="text/css" rel="stylesheet" media="all" href="/static/css/styles.home.css" />

{% endblock %}

{% block body %}

<div class="grid5col2">
  <h1 id="title"></h1>
  </div>

  <div id="carousel" class="lightbox grid5col3">
    <div class="filler"></div>
  </div>
  
  <div class="pages"></div>
  
  <a class="decision" onclick="video()">{% trans %}Watch the Video{% endtrans %}</a>

{% endblock %}

{% block js %}

<script>

  var carousel = [
  {"id": 1, "en": "Where are the Hi-Tech jobs in Minas Gerais?", "pt": "Onde estão os empregados em setores de alta tecnologia em Minas Gerais?", "image": "board", "url": "/apps/builder/geo_map/rais/mg/all/3132/bra/"},
  {"id": 2, "en": "What are the industrial opportunities for Minas Gerais?", "pt": "Quais são as oportunidades econômicas de Minas Gerais?", "image": "sparks", "url": "/apps/builder/network/rais/mg/all/all/isic/"},
  {"id": 3, "en": "Minas Gerais:<br>Home to the largest employment of Natural Science R&D.", "pt": "Minas Gerais:<br>Estado com maior quantidade de empregados em P&D em Ciências Naturais.", "image": "lab", "url": "/apps/builder/tree_map/rais/all/m7210/all/bra/"}
  ]
    
  var app = 1, stopped = false
  
  d3.select("#title")
    .html(carousel[app-1][dataviva.language])
    .on(vizwhiz.evt.click,function(){
      window.location = carousel[app-1].url
    })
  
  d3.select("#carousel")
    .on(vizwhiz.evt.click,function(){
      window.location = carousel[app-1].url
    })
    
  d3.select("#fullscreen")
    .style("background-image","url('/static/img/bgs/"+carousel[app-1].image+".jpg')")
  
  var pages = d3.select(".pages").selectAll(".page")
    .data(carousel)
    
  pages.enter().append("div")
    .attr("class","page")
    .attr("id",function(d){return "page_"+d.id})
    .style("background-color",function(d){
      if (d.id == app) return "#af1f24"
      else return "#fff"
    })
    
  pages.on(vizwhiz.evt.click,function(d){
    stopped = true
    show_app(d.id)
  })
  
  var apps = d3.select("#carousel").selectAll(".app")
    .data(carousel)
    
  apps.enter().append("div")
    .attr("class","app")
    .attr("id",function(d){return "app_"+d.id})
    .style("background-image",function(d){return "url('static/img/home/app_"+d.id+"_"+dataviva.language+".jpg')"})
    .style("opacity",function(d){
      if (d.id == app) return 1
      else return 0
    })
    .style("display",function(d){
      if (d.id == app) return "block"
      else return "none"
    })
  
  var titles = d3.select("#titles").selectAll("h1")
    .data(carousel)
    
  titles.enter().append("h1")
    .attr("id",function(d){return "title_"+d.id})
    .html(function(d){return d[dataviva.language]})
    .style("opacity",function(d){
      if (d.id == app) return 1
      else return 0
    })
    .style("display",function(d){
      if (d.id == app) return "block"
      else return "none"
    })
    
  function change_app() {
    setTimeout(function(){
      if (!stopped) {
        show_app(app+1)
        change_app()
      }
    },5000)
  }
  
  change_app()
  
  function show_app(a) {
    if (a != app) {
      var old = d3.select("#app_"+app).style("opacity",0)
      var old_title = d3.select("#title_"+app).style("opacity",0)
      d3.select("#page_"+app).style("background-color","#fff")
      setTimeout(function(){
        old.style("display","none")
        old_title.style("display","none")
      },1000)
      if (a > carousel.length) app = 1
      else app = a
      d3.select("#app_"+app).style("display","block")
      d3.select("#title_"+app).style("display","block")
      setTimeout(function(){
        d3.select("#app_"+app).style("opacity",1)
        d3.select("#title_"+app).style("opacity",1)
      },5)
      d3.select("#page_"+app).style("background-color","#af1f24")
      d3.select("#title")
        .html(carousel[app-1][dataviva.language])
      d3.select("#fullscreen")
        .style("background-image","url('/static/img/bgs/"+carousel[app-1].image+".jpg')")
    }
  }
  
  function video() {
    if (d3.select("#video").empty()) {

      dataviva.popover.create({
        "id": "video",
        "width": 800,
        "height": 450
      })
      d3.select("#video").append("iframe")
        .attr("src","//www.youtube.com/embed/Fx1-jVLnlS4?rel=0")
        .attr("width","800")
        .attr("height","450")
        .attr("frameborder","0")
        
    }
    dataviva.popover.show("#video")
  }

</script>

{% endblock %}